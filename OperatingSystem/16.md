# 컨텍스트 스위칭에 대해 설명해주세요.

`엘리`

## 컨텍스트 스위칭(Context Switching)

- OS는 각각의 프로세스가 짧은 시간 동안 돌아가면서 CPU를 점유하게 해, 동시에 동작하는 것 처럼 보이게 한다.  
- **CPU를 점유하는 프로세스를 교체하는 과정에서 기존의 프로세스의 상태를 저장하고 새로운 프로세스의 상태를 불러오는 작업을 반복하는데, 그 과정을 컨텍스트 스위칭이라고 한다.**
- 컨텍스트: CPU가 프로세스를 실행하기 위한 프로세스의 정보들을 의미하며, 이는 PCB에 저장된다.

## PCB(Process Control Block)

- OS가 프로세스들을 관리하기 위해 프로세스의 정보를 저장해 높은 자료구조
- 프로세스가 생성되면 메모리에 해당 프로세스의 PCB가 함께 생성된다. 
- 프로세스 종료 시 함께 삭제된다.

 <img width="200px" style="display: block; margin: 0 auto;" src="https://user-images.githubusercontent.com/45311765/192147843-c83dc12c-b041-4667-854f-c2f7cb739eed.png"/>
 
- 프로세스 상태
- 프로세스 식별자(PID)
- 다음 실행할 명령어 주소(PC)
- 실행이 중단된 시점의 레지스터 값
- 메모리 관리 정보
- 입출력 상태 정보 

## 컨텍스트 스위칭 과정

![image](https://user-images.githubusercontent.com/45311765/192146721-edb062b9-ee8b-4f00-b8dc-693c416464c8.png)

- idle: 아무 동작도 할 수 없는 상태
- idle이 겹치는 구간이 생겨난다. -> overhead

## Context Switching Cost

- 컨텍스트 스위칭을 진행하는 동안 CPU는 메모리에 접근해야하기 때문에 다른 일을 할 수 없게된다. 
- 따라서, 컨텍스트 스위칭이 자주 발생하면 오버헤드(성능저하)가 발생한다. 

### Process vs. Thread

- 컨텍스트 스위칭 비용은 프로세스가 스레드보다 많이 든다.
- 스레드는 stack 영역을 제외한 모든 부모 프로세스의 영역(code, data, heap)을 공유한다.
- 따라서, 스레드는 컨텍스트 스위칭 시 스택 영역만 변경하면 된다.
- 프로세스의 컨텍스트 스위칭이 일어나는 경우 지금 것 저장해 놓은 캐시가 의미없어진다.
- 하지만 스레드의 컨텍스트 스위칭이 일어나는 경우 공유하는 데이터가 있기 때문에 캐시가 의미있다. 

### CISC vs. RISC

- 컨텍스트 스위칭 시 CPU의 레지스터 값이 교체된다. 
- 따라서, CPU 구조에 따라 컨텍스트 스위칭 비용이 달라진다.
- RISC의 경우 작고 빠른 명령어들을 사용하기 위해 많은 수의 레지스터가 사용된다. 
- 따라서, CISC 보다 RISC 구조의 CPU에서 컨텍스트 스위칭 비용이 높다. 

## 참고 자료
- https://ingu627.github.io/os/os3_ewha/
- https://www.youtube.com/watch?v=-4HKhwlH3FQ
- https://chlalgud8505.tistory.com/8

## 💭 크루들의 질문

### 멀티 프로세스, 멀티 스레드의 장단점은 무엇인가요?

- 멀티 스레드의 장점
    - 프로세스를 생성해 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다.
    - 프로세스 간의 통신(IPC)보다 스레드 간의 통신 비용이 적게 든다.
    - 스레드 간의 컨텍스트 스위칭 비용이 적게 든다.
- 멀티 스레드의 단점
    - 동기화에 신경써야한다.
    - 하나의 스레드가 죽으면 다른 스레드들에도 영향이 간다.

- 따라서 이러한 멀티 스레드의 장점이 불필요하고, 하나의 스레드에서 일어난 장애가 다른 스레드들에도 영향을 주는 상황이 치명적이라면 멀티 프로세스를 쓰는 것이 좋다. 

- 크롬은 멀티 프로세스와 멀티 스레드를 모두 사용한다.
    - 멀티 프로세스: 각각의 탭이 별도의 프로세스로 실행된다. 따라서 하나의 탭이 다운되더라도 다른 탭에 영향을 주지 않는다. 탭끼리 메모리를 공유하지 않는다.
    - 멀티 스레드: 하나의 탭 안에서는 멀티 스레드를 이용해 여러 일을 동시에 처리한다. 하나의 다운로드가 끝나지 않았는데 다른 다운 로드를 실행할 수 있고, 이미지 로딩이 끝나지 않아도 다른 글들의 로딩이 되어있다.
